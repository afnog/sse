Apache24 with SSL, MySQL5 and PHP5 Installation Exercise
=====================================================

1. Intro:

The packages to be installed are:

* Apache2
* Mysql-server
* PHP5

Debian provides 2 ways of installing third party software: 
	i. Binary Packages
	This are pre-built package that contains the executables, config files, man/info pages, etc for the Debian system and have a distinguished file extension ".deb"
	
	ii. Source packages
	They contain the original unmodified source files in gzipped-compressed tar format.
 

For this class, we will install Apache, Mysql and PHP using packages.

-------------------

2. Installation of Apache, Mysql & PHP using packages:

2.1. Install portupgrade which also installs postinstall tool: 

Postinstall will allow you to install programs without knowing exactly where they reside. Using pkg, the system installs a precompiled binary which is faster to install. The ports system does not use precompiled binaries and large programs like perl would take long to compile and install.

	$ sudo apt-get update

2.2. Install Apache, Mysql and PHP

	$ sudo apt-get install mysql-server apache2 php5 mod_php5

 
2.3.  Once installed, the scripts are placed at /etc/init.d/ . To add Apache to the System Startup

	$ sudo update-rc.d apache2 enable

2.4. To start apache run

	$ sudo /etc/init.d/apache2 start

Check if the apache web server you have just installed works by pointing a browser to the server i.e. http://<your-ip-address> or http://pcXX.sse.ws.afnog.org 

You can also do 

	$ telnet localhost 80

For IPv6 to work on your virtual PC do the following:

	$ sudo su
	# echo ipv6_activate_all_interfaces="YES" >> /etc/rc.conf
	# /etc/netstart

Then set your IPv6 address to match your IPv4 address:
	$ sudo ip -6 addr add 2001:43f8:220:219::XX/64 dev eth0

Then add your default route for IPv6:
	$ sudo ip -6 route add default via 2001:43f8:220:219::1

Test your IPv6 connectivity:
	$ ping6 www.google.com


Then browse your IPv6 address at http://[2001:43f8:220:219::XX]

------------


3. Configuring SSL

To create a secure virtual host accessed via https rather than http, you will need to configure your Apache server to use OpenSSL for encrypting the data served from the web server.

The following steps should do the trick. 

3.1	Create the SSL Certificates for your Apache Web Server:

	$ mkdir /etc/apache2/ssl/
	$ cd /etc/apache2/ssl/
	$ sudo openssl genrsa -des3 -out server.key 2048 

NOTE:	Password-Phrase is needed to encrypt the key. For this exercise, use "afnog" as the pass phrase. However, this pass-phrase will be needed at every apache restart. To get rid of the pass-phrase prompts at every apache restart and maintain the original key.

	$ sudo cp server.key server.key.org
	$ sudo openssl rsa -in server.key.org -out server.key

3.1.1	Create Certificate Request

	$ sudo openssl req -new -key server.key -out server.csr
	
NOTE:	The CommonName is the name of the Website you will use in this case the localhost name i.e pcXX.sse.ws.afnog.org where XX is your computer number

3.1.2	Self Sign your Own Certificate

	$ sudo openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

3.2	Enable SSL in Apache

3.2.1 Enable SSL using the following command;

	$ a2enmod ssl

3.2.2 Copy the default-ssl.conf file from sites-available to sites-enabled and edit the /etc/apache2/sites-enabled/default-ssl.conf file and make the following changes:

	$ copy /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/
	$ ee /etc/apache2/sites-enabled/default-ssl.conf

NOTE:
* Each virtual host must have its own certificate file see comments on "CommonName".  
* The path is where the certificate File and Keys are located in this case /etc/apache2/ssl 

	SSLCertificateFile    /etc/apache2/ssl/server.crt
	SSLCertificateKeyFile /etc/apache2/ssl/server.key


3.2.3 Enable the SSL on the specific site - note the "sitename" in the syntax below is the information provided for the virtual host

	$ a2ensite sitename


Restart apache to reflect the changes
		$ sudo apachectl restart

Check if the apache web server you have just installed works by pointing a browser to the server i.e. https://<your-ip-address>:443. Or https://pcXX.sse.ws.afnog.org:443 and IPv6 as 
http://[2001:43f8:220:219:XX]:443
You can also do 

	$ telnet localhost 443

