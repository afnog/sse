---
- hosts: pc15.sse.ws.afnog.org
  tasks:
  - name: installing cowsay package
    apt:
     name: cowsay
     state: latest

  - name: create virtual host file
    template: src=pcX-vhost.j2 dest=/etc/apache2/sites-available/wwwX.{{ ansible_fqdn }}.conf

  - name: a2ensite wwwX.{{ ansible_fqdn }}
    command: a2ensite wwwX.{{ ansible_fqdn }}
    args:
       creates: /etc/apache2/sites-enabled/wwwX.{{ ansible_fqdn }}.conf
    notify:
        - restart apache2

  - name: create the root directory
    file:
     path: /var/www/html/wwwX.{{ ansible_fqdn }}
     state: directory

  - name: creating index file
    become: yes
    template:
        src: index.j2
        dest: /var/www/html/wwwX.{{ ansible_fqdn }}/index.html

  handlers:
  - name: restart apache2
    service:
     name: apache2
     state: restarted
